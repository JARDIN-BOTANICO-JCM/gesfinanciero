<?php
OperacionesCtrl::$AUTO_LOG_OUT = false;

$cfg = OperacionesCtrl::LeerConfigCorp();
$_CFG_PREMATRICULA_PAGEID = isset( $cfg[ OperacionesCtrl::CFG_PREMATRICULA_PAGEID ]) ? $cfg[ OperacionesCtrl::CFG_PREMATRICULA_PAGEID ]["val"] : "0";

$codId = false;
$cod = null;
if ( isset( $d[ 0 ] ) ) {
    $cod = $d[ 0 ];
    if ( $cod == $_CFG_PREMATRICULA_PAGEID ){
        $codId = true;
    }
}

$logoinst = self::obtener_LogoCompany();

$d_tipodoc = null;
try {
    $d_tipodoc = OperacionesCtrl::tipodoc_Obtener( array() );
} catch (\Throwable $th) {
    throw new \Exception( $th->getMessage() );
}

?>
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    	<meta http-equiv="X-UA-Compatible" content="ie=edge">		
        <meta name="description" content="">
        <meta name="author" content="">
        <meta charset="utf-8">

		
		<title>Acappdemy - Pre-matr&iacute;cula</title>
		<!-- CSS -->		
		<!-- CSS only -->
		<link rel="stylesheet" href="/temas/js/bootstrap-5.2.0-dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="/temas/js/fontawesome-free-6.1.1-web/css/all.min.css" >
		<link rel="stylesheet" href="/temas/js/flatpickr-4.6.13/flatpickr.min.css" >
		<link rel="stylesheet" href="/temas/js/dragula/dist/dragula.min.css" >
		<link rel="stylesheet" href="/temas/js/feather/feather.css">
		<link rel="stylesheet" href="/temas/js/bootstrap-icons/font/bootstrap-icons.css" />
		<link rel="stylesheet" href="/temas/js/bootstrap-select-1.14.0-beta2/dist/css/bootstrap-select.css">
		<link rel="stylesheet" href="/temas/js/simplebar-5.3.8/dist/simplebar.min.css">
		<link rel="stylesheet" href="/temas/js/DataTables/datatables.min.css" type="text/css"/>

		
		<link rel="shortcut icon" href="/temas/favicon/favicon_20x20.png" type="image/x-icon" />
		<link rel="apple-touch-icon" href="/temas/favicon/favicon_180x180.png" sizes="180x180">
        <link rel="icon" href="/temas/favicon/favicon_32x32.png" sizes="32x32" type="image/png">
        <link rel="icon" href="/temas/favicon/favicon.ico" sizes="16x16" type="image/png">
        <link rel="icon" href="/temas/favicon/favicon.ico">
		
		<!-- Custom 
		<link rel="stylesheet" href="/temas/css/theme.min.css">
		-->
		<!-- JS -->
		<script type="text/javascript" src="/temas/js/jquery-3.6.0.min.js"></script>
		<script type="text/javascript" src="/temas/js/utilidades.js?f=<?php echo date("YmdHis"); ?>"></script>
		<script type="text/javascript">var ut = new Utilidades();</script>
		<script type="text/javascript" src="/temas/js/Colecciones.js?f=<?php echo date("YmdHis"); ?>"></script>


        <style>
            .bd-placeholder-img {
                font-size: 1.125rem;
                text-anchor: middle;
                -webkit-user-select: none;
                -moz-user-select: none;
                user-select: none;
            }
    
            @media (min-width : 768px) {
                .bd-placeholder-img-lg {
                    font-size: 3.5rem;
                }
            }
    
            .b-example-divider {
                height: 3rem;
                background-color: rgba(0, 0, 0, .1);
                border: solid rgba(0, 0, 0, .15);
                border-width: 1px 0;
                box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
            }
    
            .b-example-vr {
                flex-shrink: 0;
                width: 1.5rem;
                height: 100vh;
            }
    
            .bi {
                vertical-align: -.125em;
                fill: currentColor;
            }
    
            .nav-scroller {
                position: relative;
                z-index: 2;
                height: 2.75rem;
                overflow-y: hidden;
            }
    
            .nav-scroller .nav {
                display: flex;
                flex-wrap: nowrap;
                padding-bottom: 1rem;
                margin-top: -1px;
                overflow-x: auto;
                text-align: center;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            .container {
                max-width: 960px;
            }
        </style>

	</head>

    <body class="bg-light">
    
        <div class="container">
            <main>
            
            	<?php if ( $codId ) : ?>
            
                <div class="py-5 text-center">
                    <img class="d-block mx-auto mb-4" src="<?php echo $logoinst; ?>" alt="" height="128">
                    <h2>Formulario de Pre-matr&iacute;cula</h2>
                    <!-- <p class="lead"></p> -->
                </div>
    
                <div class="row g-5" >
                    <div class="col-md-5 col-lg-4 order-md-last">
                        <h4 class="d-flex justify-content-between align-items-center mb-3">
                            <span class="text-primary">Resumen del proceso</span>
                            <!-- <span class="badge bg-primary rounded-pill">0</span> -->
                        </h4>
                        <div class="list-group mb-3">
                            <button class="list-group-item list-group-item-action list-group-item-info lh-sm " onclick="tabEff( this );" data-idtab="#tab-identifica">
                                <h6 class="my-0">
                                	<i class="fas fa-id-card-alt"></i> Identif&iacute;quese
                                </h6>
                                <small class="text-muted">Con estos datos sabremos qui&eacute;nes son sus hijos o dependientes</small>
                                <!-- <span class="text-muted">$12</span> -->
                            </button>
                            
                            <button id="btnEstuItem" class="list-group-item list-group-item-action lh-sm disabled" onclick="tabEff( this );" data-idtab="#tab-mylist">
                                <div>
                                    <h6 class="my-0">
                                    	<i class="fas fa-check-square"></i> Confirmaci&oacute;n cupos
                                    </h6>
                                    <small class="text-muted">Confirmaci&oacute;n de cupos de cada estudiante</small>
                                </div>
                            </button>

                        </div>
                    </div>
                    <div id="frmval" class="col-md-7 col-lg-8 frmvalcls">

						<div class="tab-pane active" id="tab-identifica">
                    		<form id="frmval_2" class="frmvalcls_2">
                    		
    							<h4 class="mb-3 pb-3 border-bottom">
    								<i class="fas fa-id-card-alt"></i> Identif&iacute;quese
    							</h4>
                                
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <h4 class="mb-1">Identificaci&oacute;n del padre o acudiente</h4>
                                        </div>
                                        <div class="row">
                        
                                            <div class="mb-3 col-md-6">
                                                <label class="form-label" for="tipodoc_id">Tipo de documento</label>
                                                <select class="form-select" aria-label="Default select example" id="tipodoc_id" name="tipodoc_id" required="">
                                                    <?php foreach( $d_tipodoc as $v ) : ?>
                                                    <option value="<?php echo $v['id'] ?>"><?php echo $v['nombre'] ?></option>
                                                    <?php endforeach; ?>
                                                </select>
                                            </div>
                                            <div class="mb-3 col-md-6">
                                                <label class="form-label" for="documento">N&uacute;mero de documento</label>
                                                <input type="text" class="form-control" placeholder="N&uacute;mero de documento" id="documento" name="documento" required="">
                                            </div>
                                        </div>
                        
                                    </div>
                                </div>
                                
                                <hr class="my-4">
                                
                        		<div class="row g-3">
                                    <div class="col-sm-12">
                                    	<button class="w-100 btn btn-primary btn-lg" type="button" onclick="revExists( this );" data-fin="false">Continuar</button>
                                    </div>
                                </div>
							</form>
                    	</div>

                    	<div class="tab-pane" style="display: none;" id="tab-mylist">
                    		<form id="frmval_4" class="frmvalcls_4">
                    		
    							<h4 class="mb-3 pb-3 border-bottom"><i class="fas fa-check-square"></i> Confirmaci&oacute;n cupos</h4>
                                
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h4 class="mb-4">Datos principales y cupos</h4>
                        
                                        <div id="malladatos" class="row"></div>
                                    </div>
                                </div>

                                
                                <hr class="my-4">
                                
                        		<div class="row g-3">
                                    <div class="col-sm-12">
                                    	<button class="w-100 btn btn-primary btn-lg" type="button" onclick="deOrder( this );" data-fin="true">Terminar</button>
                                    </div>
                                </div>
                                
							</form>
                    	</div>

                    </div>
                </div>

            
                <?php else : ?>
                
                <div class="py-5 text-center">
                    <img class="d-block mx-auto mb-4" src="<?php echo $logoinst; ?>" alt="" height="128">
                    <h2>Formulario de Pre-matr&iacute;cula</h2>
                </div>
                
                <div class="row g-5">
                	<div id="frmval" class="col-md-12 col-lg-12 frmvalcls">
                    	<div class="alert alert-danger d-flex align-items-center" role="alert">
                          <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                          <div>
                            El c&oacute;digo <?php echo $cod; ?> es incorrecto.
                          </div>
                        </div>
                        <p>Confirme directamente con la instituci&oacute;n la url y c&oacute;digo correcto.</p>
                	</div>
                </div>
                
                <?php endif; ?>
            </main>
    
            <footer class="my-5 pt-5 text-muted text-center text-small">
                <p class="mb-1">&copy; 2022 Acappdemy</p>
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="#">Privacy</a></li>
                    <li class="list-inline-item"><a href="#">Terms</a></li>
                    <li class="list-inline-item"><a href="#">Support</a></li>
                </ul>
            </footer>
        </div>
        
        <script type="application/javascript">
    	const activo = "list-group-item-info"; 
    	
        /**
         * Aplica la lógica de "deOrder" al argumento proporcionado.
         *
         * @param mixed $o Valor u objeto de entrada a procesar.
         * @return mixed Resultado devuelto por la función deOrder.
         */
        const deOrder = function( o ){
        	const _o = jQuery( o );
        	const fin = _o.data('fin');
        	const cls = _o.parent().parent().parent();
        	ut.validarFrm( cls.attr('class') , function( d ){
        		
        		if( fin === true ){
        			actualizar();
        		}
        		else{
        			jQuery('.list-group .' + activo).next().trigger('click');
        		}
        		
        	});
        };
        
        /**
         * Construye o actualiza la tabla de efectivos usando los datos u opciones proporcionadas.
         *
         * @param {Object} o Objeto con configuración y/o datos necesarios para generar la tabla.
         * @returns {void} No devuelve valor; realiza cambios en el DOM o en la estructura interna.
         */
        const tabEff = function( o ){
        	const _o = jQuery( o );
        	if( !_o.hasClass( activo ) ){
            	const tb = _o.data('idtab');
            	jQuery( '.tab-pane' ).hide();
            	jQuery( tb ).show('fast');
            	
            	jQuery( _o ).removeClass('disabled');
            	//jQuery( '.list-group-item' ).attr('class','list-group-item list-group-item-action lh-sm');
            	jQuery( '.list-group-item' ).removeClass( activo );
            	
            	_o.addClass( activo );
            	
            	jQuery('.zaque-selectpck').selectpicker('render');
        	}
        };
        
        /**
         * Recolecta datos desde un formulario y los entrega a un callback.
         *
         * @param {HTMLFormElement|Object} frm Elemento formulario o conjunto de datos a procesar.
         * @param {Function} fn Callback que se ejecuta con los datos recolectados.
         * @returns {void}
         */
        const recolectar = function( frm, fn ){
        	var o = jQuery( frm );
      		jsonObj = [];
      		jQuery("#" + o.attr('id') + " input, #" + o.attr('id') + " select").each(function() {
    			var nombre = jQuery(this).attr("name");
    			var valor = ("" + jQuery(this).val()).replace(/\\/ig, "/");
    			
    			if(jQuery.trim( valor ).length > 0){
        			jsonObj.push('"' + nombre + '" : "' + valor + '"');
    			}
      		});
      		var tmpJson = JSON.parse("{" + jsonObj.join(',') + "}");
      		
      		fn( tmpJson );
        };
        
        /**
         * Actualiza la prematrícula: envía los cambios al servidor y refresca la interfaz según la respuesta.
         *
         * @return void
         */
        const actualizar = function(){
            var fld = [];
            
        	recolectar('.frmvalcls', function ( r ) {
        		const opc = { 'id' : 'ajaxldr' };
                const objmdl = mngModal.dibujar( opc );
                jQuery( objmdl ).modal('show');
        
        		const form_data = new FormData();
                form_data.append('ajax', '<?php echo md5( IndexCtrl::API_PrematriculaMod ); ?>');
                form_data.append('data' , ut.b64EncodeUnicode( JSON.stringify( r ) ) );
                
                jQuery(".datacupo").each(function(i,ob){
                	const _ob = jQuery( ob );
                	continuaData( _ob );
                });
        
        		__TransportarData(
        			form_data,
        			function( o ) {
                        const objmdlErr = mngModal.dibujar( { 'id' : 'mdlError', 'title' : 'Estado de la operaci&oacute;n','btnCerrarX' : true, 'center' : true, 'level' : 'err' } );
                        
        				const alerta = jQuery(objmdlErr + ' div.alert');
                        alerta.attr('class','alert alert-success');
                        
                        const htmlTxt = [];
                        htmlTxt.push( '<center><strong>Transacci&oacute;n exitosa</strong><center><br />' );
                        htmlTxt.push( 'Sus cupos est&aacute;n confirmados' );
                        
                        alerta.html( htmlTxt.join('') );
        
        				jQuery( objmdlErr ).modal('show');
        				setTimeout(function(){ jQuery( objmdl ).modal('hide'); }, <?php echo IndexCtrl::TIEMPO_AJAX_LDN ?>);
        			},
        			function ( err ) {
                        const objmdlErr = mngModal.dibujar( { 'id' : 'mdlError', 'title' : 'Error','btnCerrarX' : true, 'level' : 'err' } );
                        const alerta = jQuery(objmdlErr + ' div.alert');
                        alerta.attr('class','alert alert-danger');

                        const errjson = JSON.parse( err.responseText );
                        var txtW = errjson.err;
                        console.log(errjson);
                        if( ("" + txtW).toLowerCase().startsWith('duplicate') ){
                        	var nwerr = ("" + txtW).toLowerCase().replace('duplicate entry','');
                        	nwerr = ("" + nwerr).replace('for key',';');
                        	nwerr = ("" + nwerr).replace(/'/ig,'');
                        	strprs = nwerr.split(';');
                        	
                        	if( jQuery.trim(strprs[1]) == 'estudiantes.numdoc' ){
                        		txtW = 'La identificaci&oacute;n ' + jQuery.trim( strprs[0] ) + ' ya existe.';
                        	}
                        	
                        	alerta.html( txtW );
                        }else{
                        	alerta.html( errjson.err );
                        }

        
                        jQuery( objmdlErr ).modal('show');
        				setTimeout(function(){ jQuery( objmdl ).modal('hide'); }, <?php echo IndexCtrl::TIEMPO_AJAX_LDN ?>);
        			}
        		);
        	});
        };
        
        /**
         * Genera la plantilla HTML para el bloque de información del acudiente.
         * @param {Object} d - Datos del acudiente (nombre, documento, teléfono, etc.).
         * @returns {string} Cadena HTML con la plantilla renderizada.
         */
        const tplAcudiente = function( d ){
        	const rHtml = [];
        	rHtml.push( '<div class="mb-3 col-md-12"> ');
            rHtml.push( '	<div class="form-control d-flex justify-content-between align-items-start lh-sm" > ');
            rHtml.push( '		<div class="ms-2 me-auto"> ');
            rHtml.push( '			<div><strong>' + d['fullname'] + '</strong></div> ' );
            rHtml.push( '			<small class="text-muted">Nombre del acudiente</small> ' );
            rHtml.push( '		</div> ');
            rHtml.push( '	</div> ');
            
            rHtml.push( '<input type="hidden" name="acudientes_id" id="acudientes_id" value="' + d['acudientes_id'] + '"> ');
            rHtml.push( '<input type="hidden" name="acudientes" id="acudientes" value="' + d['fullname'] + '"> ');
            
            rHtml.push( '</div> ');
            
            return rHtml.join('');
        };
        
        /**
         * Genera el template HTML para un ítem de dependientes.
         *
         * @param {Object} _el Datos del dependiente.
         * @returns {string} HTML del elemento dependiente.
         */
        const tplItemDependientes = function( _el ){
        	const estid = _el['estudiantes_id'];
	        let chkDt = "";
        	let txtDt = "no";
        	if( _el['continua'] == "si" ) {
        		chkDt = 'checked="checked"';
        		txtDt = "si";
        	}
        	
        	const rHtml = [];
        	
        	rHtml.push( '	<label class="list-group-item d-flex justify-content-start align-items-start "> ' );
        	rHtml.push( '		<input ' + chkDt + ' data-target="#estid_' + estid + '" class="form-check-input me-1 datacupo" type="checkbox" value="" onchange="continuaData( this );"> ' );
        	rHtml.push( '		<div class="lh-sm">' );
        	rHtml.push( '			' + _el['estudiantes'] + '<br />' );
        	rHtml.push( '			<small class="text-muted">' + _el['est_documento'] + '</small>' );
        	rHtml.push( '		</div>' );
        	rHtml.push( '		<input id="estid_' + estid + '" name="estid_' + estid + '" type="hidden" value="' + txtDt + '"> ' );
        	rHtml.push( '	</label>' );
        	
        	return rHtml.join('');
        };
        
        /**
         * Verifica si existe una revisión en el objeto proporcionado.
         *
         * @param {*} o Objeto o valor a comprobar.
         * @returns {boolean} True si la revisión existe; false en caso contrario.
         */
        const revExists = function( o ){
        	const _o = jQuery( o );
        	const cls = _o.parent().parent().parent();
        	
        	const malladatos = jQuery('#malladatos');
        	
        	ut.validarFrm( cls.attr('class') , function( d ){
        		
        		const mtdV =  { 'tipodoc_id' : jQuery.trim( jQuery('#tipodoc_id').val() ), 'documento' : jQuery.trim( jQuery('#documento').val() ) } ;
        		const jsTxt = ut.b64EncodeUnicode( JSON.stringify ( mtdV ) );
        		
        		const opc = { 'id' : 'ajaxldr','size' : 'modal-sm' };
                const objmdl = mngModal.dibujar( opc );
                jQuery( objmdl ).modal('show');
            	
            	const form_data = new FormData();
            	form_data.append('ajax', '<?php echo md5( IndexCtrl::API_PrematriculaModVistoHelper ); ?>');
            	form_data.append('data', jsTxt );
            
                __TransportarData(
                    form_data,
                    function( nwDt ) {
                    	if( nwDt.length > 0 ){
                    	
                    		const rHtml = [];
                    		let primero = true;
                    	
                        	for (const key in nwDt ) {
                            	if (Object.hasOwnProperty.call( nwDt, key)) {
                                	const _el = nwDt[key];
                                	
                                	if( primero ){
                                        rHtml.push( tplAcudiente( _el ) );
                                        
                                        rHtml.push( '<div class="mb-3 col-md-12"> ' );
                                        rHtml.push( '	<h6>Seleccione los cupos que desea confirmar</h6> ' );
                                        rHtml.push( '	<div class="list-group"> ' );

                                        primero = false;
                                	}
                                	
                                	rHtml.push( tplItemDependientes( _el ) );
                                	
                            	}
                        	}
                        	
                        	rHtml.push( '	<button id="btnAddNewDep" type="button" rol="button" class="list-group-item action list-group-item-primary " onclick="agregarNuevoDependienteWin( this );" > ' );
                        	rHtml.push( '		Agregar otro dependiente ' );
                        	rHtml.push( '	</button> ' );
                        	
                        	rHtml.push( '	</div> ' );
                        	rHtml.push( '</div> ' );
                        	
                        	malladatos.html( rHtml.join('') );
                    	}
                    	else{
                    	
                    		const rHtml = [];
                    		rHtml.push( '<div class="mb-3 col-md-12"> ');
                            rHtml.push( '	<div class="alert alert-danger d-flex align-items-center"> ');
                            rHtml.push( '		<svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Info:"><use xlink:href="#gbl-info-fill"/></svg> ');
                            
                            //jQuery('#tipodoc_id').val();
                            
                            rHtml.push( '		<div > ');
                            rHtml.push( '			<h5>Error en ' + jQuery('#tipodoc_id option:selected').text() + ' #' + ut.intToPesos( jQuery('#documento').val() ,0,",",".") + '</h5> ');
                            rHtml.push( '			Sus datos no registran en nuestra base de datos. Contacte el personal administrativo del colegio.</div> ');
                            rHtml.push( '		</div> ');
                            rHtml.push( '	</div> ');
                            rHtml.push( '</div> ');
                    	
                    		malladatos.html( rHtml.join('') );
                    	}
            			deOrder( o );
            			
            			setTimeout(function(){ jQuery( objmdl ).modal('hide'); }, <?php echo IndexCtrl::TIEMPO_AJAX_LDN ?>);
                    },
                    function ( err ) {
                        const objmdlErr = mngModal.dibujar( { 'id' : 'mdlError', 'title' : 'Error','btnCerrarX' : true, 'level' : 'err', 'size' : 'modal-sm' } );
                        const alerta = jQuery(objmdlErr + ' div.alert');
                        alerta.attr('class','alert alert-danger');
                        alerta.html( err.responseText );
            
                        jQuery( objmdlErr ).modal('show');
                        setTimeout(function(){ jQuery( objmdl ).modal('hide'); }, <?php echo IndexCtrl::TIEMPO_AJAX_LDN ?>);
                    }
                );

        	});
        };
        
        /**
         * continuaData - Procesa los datos recibidos y continua el flujo de la prematrícula.
         *
         * @param {Object} o  Objeto con los datos a procesar (estado/formulario).
         * @returns {void}    No retorna valor; actualiza la interfaz o el estado según 'o'.
         */
        const continuaData = function( o ){
			const _o = jQuery( o );
			const dt = _o.data();
			const target = jQuery( dt['target']);
			
			if( _o.is(':checked') ){
				target.val('si');
			}
			else{
				target.val('no');
			}
        };
        
        /**
         * Abre y configura la ventana/modal para agregar un nuevo dependiente.
         *
         * @param {Object} o Objeto de opciones (datos iniciales, callbacks y configuraciones).
         * @returns {void}
         */
        const agregarNuevoDependienteWin = function( o ){
        	const _o = jQuery( o );
        	const objmdlErr = mngModal.dibujar( { 'id' : 'mdlError', 'title' : 'Nuevo dependiente','btnCerrarX' : true, 'center' : true, 'level' : 'err', 'size' : 'modal-lg' } );
                        
			const alerta = jQuery(objmdlErr + ' div.alert');
            alerta.attr('class','row');
            
            const htmlTxt = [];
            
            htmlTxt.push( '<form class="frmNwDepCls" id="frmNwDep" method="post" action="./index.php" > ' );
			htmlTxt.push( '	<div class="col-12"> ' );
			htmlTxt.push( '		<div id="nwdivalert" class="row" style="display: none;" > ' );
			htmlTxt.push( '			<div class="col-md" > ' );
			htmlTxt.push( '				<div class="alert"></div> ' );
			htmlTxt.push( '			</div> ' );
			htmlTxt.push( '		</div> ' );
			htmlTxt.push( '		<div class="row g-2 mb-3"> ' );
            htmlTxt.push( ' 		<div class="col-md"> ' );
            htmlTxt.push( '				<div class="form-floating"> ' );
            htmlTxt.push( '					<select class="form-select" id="txtnw_tipodoc_id" name="txtnw_tipodoc_id" aria-label="Tipo de documento"> ' );
            <?php foreach ( $d_tipodoc as $vDt ) : ?>
            htmlTxt.push( '						<option <?php echo ( $vDt['id'] == 13 ? 'selected="selected"' : ''); ?> value="<?php echo $vDt['id'] ?>"><?php echo $vDt["nombre"] ?></option> ' );
            <?php endforeach; ?>
            htmlTxt.push( '					</select> ' );
            htmlTxt.push( '				<label for="txtnw_tipodoc_id">Tipo de documento</label> ' );
            htmlTxt.push( '				</div> ' );
            htmlTxt.push( '			</div> ' );
            htmlTxt.push( '			<div class="col-md"> ' );
            htmlTxt.push( '				<div class="form-floating"> ' );
            htmlTxt.push( '					<input type="text" class="form-control" id="txtnw_documento" name="txtnw_documento" placeholder="" value="" required="required"> ' );
            htmlTxt.push( '					<label for="txtnw_documento">N&uacute;mero de documento</label> ' );
            htmlTxt.push( '				</div> ' );
            htmlTxt.push( '			</div> ' );
            htmlTxt.push( '		</div> ' );
            htmlTxt.push( '		<div class="row g-2 mb-3" > ' );
			htmlTxt.push( '			<div class="col-8 d-grid gap-2" > ' );
			htmlTxt.push( '				<button data-target="#' + _o.attr('id') + '" class="btn btn-primary" type="button" onclick="agregarNuevoDependiente( this );">Agregar</button> ' );
			htmlTxt.push( '			</div> ' );
			htmlTxt.push( '			<div class="col-4 d-grid gap-2" > ' );
			htmlTxt.push( '				<button class="btn btn-outline-danger" type="button" data-bs-dismiss="modal">Cancelar</button> ' );
			htmlTxt.push( '			</div> ' );
			htmlTxt.push( '		</div> ' );
            htmlTxt.push( '	</div>' );
            
            htmlTxt.push( '	<input type="hidden" id="txtnw_acudientes_id" name="txtnw_acudientes_id" value="' + jQuery('#acudientes_id').val() + '" /> ' );
            htmlTxt.push( '</form> ' );
            
            alerta.html( htmlTxt.join('') );

			jQuery( objmdlErr ).modal('show');
        };
        
        /**
         * Agrega un nuevo dependiente al formulario/listado de prematrícula.
         * @param {Object} o - Objeto con los datos del dependiente (nombre, parentesco, edad, etc.).
         * @returns {void}
         */
        const agregarNuevoDependiente = function( o ){
        	const _o = jQuery( o );
        	const dt = _o.data();
        	const target = dt['target'];
        	
        	ut.validarFrm( 'frmNwDepCls' , function( d ){
        		const jsTxt = ut.b64EncodeUnicode( JSON.stringify ( d ) );

        		const alerta = jQuery( '#nwdivalert' );
                const objAlert = alerta.find( '.alert' );
                objAlert.attr('class', 'alert alert-warning');
                objAlert.html( 'Confirmando datos...' );

            	const form_data = new FormData();
            	form_data.append('ajax', '<?php echo md5( IndexCtrl::API_PrematriculaAddDependienteHelper ); ?>');
            	form_data.append('data', jsTxt );

                __TransportarData(
                    form_data,
                    function( nwDt ) {
                    	const cfg = { 
                    		'continua' : 'no',
                    		'estudiantes_id' : nwDt['id'],
                    		'estudiantes' : nwDt['nombres'] + ' ' + nwDt['apellidos'],
                    		'est_documento' : nwDt['documento']
                    	};
                    	jQuery( target ).before( tplItemDependientes( cfg ) );
                    	
                    	objAlert.attr('class', 'alert alert-warning');
		                objAlert.html( 'Registro agregado correctamente' );
                    	
                    },
                    function ( err ) {
                        objAlert.attr('class', 'alert alert-danger');
                        
                        const jsonEr = JSON.parse( err.responseText );
                        const txtParts = jsonEr['err'].split(":");
                        objAlert.html( txtParts[ txtParts.length - 1 ] );
                        
                        alerta.show('fast');
                        
                    }
                );
                
        	});
        };
        
        /**
         * Inicializa la lógica de la plantilla de prematrícula cuando el DOM está listo.
         *
         * Registra controladores de eventos e inicializa los componentes de interfaz necesarios.
         */
        jQuery( document ).ready(function(){
        	jQuery('.zaque-selectpck').selectpicker();
        });
        
        </script>


